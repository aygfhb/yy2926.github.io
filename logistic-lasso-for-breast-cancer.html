<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Implementing Logistic-LASSO for Predicting Breast Cancer</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Yuxin Yang</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-bar-chart fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="resume.html">
    <span class="fa fa-file-alt fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Implementing Logistic-LASSO for Predicting Breast Cancer</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Breast cancer screening is a useful technique to detect breast cancer at an early stage, even before there are signs or symptoms of the disease. Though we have plenty of medical screening test, there is still room to improve it technically and statistically. An effective way is of breast cancer prediction is based on the breast image.</p>
<p>In this report, we intend to propose a Logistic-Lasso model to select features and predict breast cancer status from the imaging dataset. Two techniques we interest will be the logistic model with Newton-Raphson optimization and the descending pathwise coordinatewise optimization.</p>
</div>
<div id="data-cleaning" class="section level1">
<h1>Data Cleaning</h1>
<p>The breast cancer dataset has 569 row and 33 columns. That is, there are 569 observations of breast cancer diagnosis (malignant or benign), each with 30 potential features. The three columns that were not useful covariates are: “id,” “diagnosis” (outcome variable) and a non-relevant column of NA values. The “diagnosis” outcome variable specifies if the image is coming from a cancer tissue or a benign one.</p>
<p>Lasso is sensitive to the scale of the predictors, so we standardized the dataset to make sure those larger scales predictors will not dominate over those with smaller ranges of values. Many of the columns in the data are highly correlated with each other, so we drop features that show a high correlation, with cutoff 0.85.The following is the correlation plot, and 17 variables are kept in the model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">require</span>(knitr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">require</span>(survival)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">require</span>(quantreg)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">require</span>(glmnet)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">require</span>(MASS)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">require</span>(pROC)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">require</span>(readr)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">require</span>(GGally)</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">library</span>(corrplot)</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">require</span>(magrittr)</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">require</span>(dplyr)</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">require</span>(purrr)</a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">require</span>(matrixcalc)</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb1-15" title="15"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-16" title="16"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb1-17" title="17"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb1-18" title="18"><span class="kw">set.seed</span>(<span class="dv">2019</span>)</a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co"># Data preparation</span></a>
<a class="sourceLine" id="cb1-21" title="21">dat.original &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;breastcancer.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-22" title="22">dat &lt;-<span class="st"> </span>dat.original <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(id,X33))</a>
<a class="sourceLine" id="cb1-24" title="24"></a>
<a class="sourceLine" id="cb1-25" title="25">dat<span class="op">$</span>diagnosis &lt;-<span class="st"> </span><span class="kw">ifelse</span>(dat<span class="op">$</span>diagnosis <span class="op">==</span><span class="st"> &quot;M&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-26" title="26"></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="co"># Normalization</span></a>
<a class="sourceLine" id="cb1-28" title="28">normalize &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1-29" title="29">  <span class="kw">return</span>((x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(x))</a>
<a class="sourceLine" id="cb1-30" title="30">}</a>
<a class="sourceLine" id="cb1-31" title="31"></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="co"># normalize all features</span></a>
<a class="sourceLine" id="cb1-33" title="33">dat.norm &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(dat[,<span class="dv">2</span><span class="op">:</span><span class="dv">31</span>], normalize))</a>
<a class="sourceLine" id="cb1-34" title="34">dat.norm &lt;-<span class="st"> </span><span class="kw">cbind</span>(dat<span class="op">$</span>diagnosis, dat.norm)</a>
<a class="sourceLine" id="cb1-35" title="35"><span class="kw">names</span>(dat.norm)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;diagnosis&quot;</span></a>
<a class="sourceLine" id="cb1-36" title="36"></a>
<a class="sourceLine" id="cb1-37" title="37"><span class="co"># Removing columns that have high multicollinearity with others</span></a>
<a class="sourceLine" id="cb1-38" title="38"></a>
<a class="sourceLine" id="cb1-39" title="39">corr &lt;-<span class="st"> </span><span class="kw">cor</span>(dat.norm) </a>
<a class="sourceLine" id="cb1-40" title="40">highCorr &lt;-<span class="st"> </span><span class="kw">findCorrelation</span>(corr, <span class="dt">cutoff =</span> <span class="fl">0.85</span>, <span class="dt">exact =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb1-41" title="41">highCorr.names &lt;-<span class="st"> </span><span class="kw">findCorrelation</span>(corr, <span class="dt">cutoff =</span> <span class="fl">0.85</span>, <span class="dt">exact =</span> <span class="ot">TRUE</span>,  <span class="dt">names =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb1-42" title="42">dat.norm.use &lt;-<span class="st"> </span>dat.norm[,<span class="op">-</span><span class="kw">c</span>(highCorr)]</a>
<a class="sourceLine" id="cb1-43" title="43">p.mat &lt;-<span class="st"> </span><span class="kw">cor.mtest</span>(corr)<span class="op">$</span>p </a>
<a class="sourceLine" id="cb1-44" title="44"><span class="kw">corrplot</span>(corr, <span class="dt">method=</span><span class="st">&quot;circle&quot;</span>, </a>
<a class="sourceLine" id="cb1-45" title="45">         <span class="dt">order =</span> <span class="st">&quot;hclust&quot;</span>, </a>
<a class="sourceLine" id="cb1-46" title="46">         <span class="dt">type =</span> <span class="st">&quot;upper&quot;</span>,</a>
<a class="sourceLine" id="cb1-47" title="47">         <span class="dt">p.mat =</span> p.mat, </a>
<a class="sourceLine" id="cb1-48" title="48">         <span class="dt">sig.level =</span> <span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb1-49" title="49">         <span class="dt">insig =</span> <span class="st">&quot;blank&quot;</span>,</a>
<a class="sourceLine" id="cb1-50" title="50">         <span class="dt">diag =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1-51" title="51">         <span class="dt">tl.cex =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb1-52" title="52">         <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">name =</span> <span class="st">&quot;RdYlBu&quot;</span>))</a></code></pre></div>
<div class="figure">
<img src="pic/corr_plot.png" alt="Correlation Plot" />
<p class="caption">Correlation Plot</p>
</div>
</div>
<div id="proposed-model" class="section level1">
<h1>Proposed Model</h1>
<div id="newton-raphson-optimization" class="section level2">
<h2>Newton-Raphson optimization</h2>
<p>The logistic model for malignant cancer is</p>
<p><span class="math display">\[P(Y_i = 1 | X= x) = \frac{exp(\beta_0 + \boldsymbol{X_i}\boldsymbol{\beta})}{1+exp(\beta_0 +\boldsymbol{X_i}\boldsymbol{\beta})}\]</span></p>
<p>We sought to minimize the log-likelihood function <span class="math inline">\(l(y;\boldsymbol{\beta})\)</span> <span class="math display">\[l(\beta) = \sum_{i=1}^{n}(Y_i(\beta_0+\boldsymbol{X_i\beta}) - log(1+exp(\beta_0 + \boldsymbol{X_i\beta})))\]</span> The Newton-Raphson optimization is fullfilled by using gradient and Hessian matrix, and the coefficients are update in each steps with the following equation:</p>
<p><span class="math display">\[\boldsymbol{\beta_{i+1}} = \boldsymbol{\beta_{i}} - [\bigtriangledown^2l(\boldsymbol{\beta_i)}]^{-1} \bigtriangledown l(\boldsymbol{\beta_i})\]</span></p>
</div>
<div id="the-algorithm" class="section level2">
<h2>The Algorithm</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">##hessian matrix</span></a>
<a class="sourceLine" id="cb2-2" title="2">hess &lt;-<span class="st"> </span><span class="cf">function</span>(x, p){</a>
<a class="sourceLine" id="cb2-3" title="3">  hess =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="kw">ncol</span>(x), <span class="kw">ncol</span>(x))</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(x)){</a>
<a class="sourceLine" id="cb2-5" title="5">    a &lt;-<span class="st"> </span>x[i,] <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(x[i,]) <span class="op">*</span><span class="st"> </span>p[i] <span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p[i])</a>
<a class="sourceLine" id="cb2-6" title="6">    hess &lt;-<span class="st"> </span>hess <span class="op">+</span>a</a>
<a class="sourceLine" id="cb2-7" title="7">  }</a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="kw">return</span>(<span class="op">-</span>hess)</a>
<a class="sourceLine" id="cb2-9" title="9">}</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">##logistic model</span></a>
<a class="sourceLine" id="cb2-11" title="11">logisticstuff &lt;-<span class="st"> </span><span class="cf">function</span>(x,y, betavec){</a>
<a class="sourceLine" id="cb2-12" title="12">  u &lt;-<span class="st"> </span>x <span class="op">%*%</span><span class="st"> </span>betavec</a>
<a class="sourceLine" id="cb2-13" title="13">  expu &lt;-<span class="st"> </span><span class="kw">exp</span>(u)</a>
<a class="sourceLine" id="cb2-14" title="14">  <span class="co">## create loglike for large p</span></a>
<a class="sourceLine" id="cb2-15" title="15">  loglik &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="kw">nrow</span>(x), <span class="dt">mode =</span> <span class="st">&quot;numeric&quot;</span>)</a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(x))</a>
<a class="sourceLine" id="cb2-17" title="17">    loglik[i] &lt;-<span class="st"> </span>y[i]<span class="op">*</span>u[i] <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span><span class="op">+</span>expu[i])</a>
<a class="sourceLine" id="cb2-18" title="18">  <span class="co">## log-likelihood at betavec</span></a>
<a class="sourceLine" id="cb2-19" title="19">  loglik &lt;-<span class="st"> </span><span class="kw">sum</span>(loglik)</a>
<a class="sourceLine" id="cb2-20" title="20">  p &lt;-<span class="st"> </span>expu <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">+</span>expu)</a>
<a class="sourceLine" id="cb2-21" title="21">  <span class="co">## P(Y_i = 1 | x_i)</span></a>
<a class="sourceLine" id="cb2-22" title="22">  grad &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="kw">length</span>(betavec), <span class="dt">mode =</span> <span class="st">&quot;numeric&quot;</span>)</a>
<a class="sourceLine" id="cb2-23" title="23">  <span class="co">## gradient at betavec</span></a>
<a class="sourceLine" id="cb2-24" title="24">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">18</span>)</a>
<a class="sourceLine" id="cb2-25" title="25">    grad[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">t</span>(x[,i]) <span class="op">%*%</span><span class="st"> </span>(y <span class="op">-</span><span class="st"> </span>p))</a>
<a class="sourceLine" id="cb2-26" title="26">  <span class="co">## function for hess due to large p value</span></a>
<a class="sourceLine" id="cb2-27" title="27">  Hess &lt;-<span class="st"> </span><span class="kw">hess</span>(x , p)</a>
<a class="sourceLine" id="cb2-28" title="28">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">loglik =</span> loglik, <span class="dt">grad =</span> grad, <span class="dt">Hess =</span> Hess))</a>
<a class="sourceLine" id="cb2-29" title="29">}</a>
<a class="sourceLine" id="cb2-30" title="30"></a>
<a class="sourceLine" id="cb2-31" title="31">NewtonRaphson &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, func, start, <span class="dt">maxiter =</span> <span class="dv">15</span>, <span class="dt">tol =</span> <span class="fl">1e-5</span>) {</a>
<a class="sourceLine" id="cb2-32" title="32">  i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2-33" title="33">  cur &lt;-<span class="st"> </span>start</a>
<a class="sourceLine" id="cb2-34" title="34">  stuff&lt;-<span class="st"> </span><span class="kw">func</span>(x,y, cur)</a>
<a class="sourceLine" id="cb2-35" title="35">  res &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, cur)</a>
<a class="sourceLine" id="cb2-36" title="36">  prevloglik &lt;-<span class="st"> </span><span class="op">-</span><span class="ot">Inf</span></a>
<a class="sourceLine" id="cb2-37" title="37">  <span class="cf">while</span>(i <span class="op">&lt;</span><span class="st"> </span>maxiter <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">abs</span>(stuff<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>prevloglik) <span class="op">&gt;</span><span class="st"> </span>tol){</a>
<a class="sourceLine" id="cb2-38" title="38">    i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-39" title="39">    prevloglik &lt;-<span class="st"> </span>stuff<span class="op">$</span>loglik</a>
<a class="sourceLine" id="cb2-40" title="40">    prev &lt;-<span class="st"> </span>cur</a>
<a class="sourceLine" id="cb2-41" title="41">    cur &lt;-<span class="st"> </span>prev <span class="op">-</span><span class="st"> </span><span class="kw">solve</span>(stuff<span class="op">$</span>Hess) <span class="op">%*%</span><span class="st"> </span>stuff<span class="op">$</span>grad</a>
<a class="sourceLine" id="cb2-42" title="42">    stuff &lt;-<span class="st"> </span><span class="kw">func</span>(x,y, cur)</a>
<a class="sourceLine" id="cb2-43" title="43">    res &lt;-<span class="st"> </span><span class="kw">rbind</span>(res,<span class="kw">c</span>(i,cur))</a>
<a class="sourceLine" id="cb2-44" title="44">  }</a>
<a class="sourceLine" id="cb2-45" title="45">  <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb2-46" title="46">}</a></code></pre></div>
</div>
<div id="the-logistic-lasso-model-with-descending-coordinatewise" class="section level2">
<h2>The Logistic-Lasso model with descending coordinatewise</h2>
<p>The Logistic-Lasso model for malignant cancer is given by log-li <span class="math display">\[ f_{obj} =  min_{(\beta_0, \boldsymbol{\beta})}[ {\frac{1}{2n} \sum_{i = 1}^{n} w_i(z_i - \beta_0 - \boldsymbol{x_i\beta}^2)} + \lambda \sum_{j = 0}^{p}|\beta_j|] \]</span> <span class="math inline">\(w_i\)</span> is the working weight and <span class="math inline">\(z_i\)</span> is the working response,<span class="math inline">\(\beta_0\)</span> is the intercept and <span class="math inline">\(\mathbf{\beta}\)</span> is the set variable coeffients. Each variable coeffients <span class="math inline">\(\beta_{j}\)</span> was optimized using the following equation: <span class="math display">\[\tilde{\beta_j} = \frac{S(\sum_i\omega_ix_{i,j}(y_i - \tilde{y}_i^{(-j)}), \gamma)}{\sum\omega_ix^2_{i,j}}\]</span> where <span class="math inline">\(S\)</span> is the weighted soft threshold function, <span class="math inline">\(y^{-j}\)</span> is the response without <span class="math inline">\(\beta_j\)</span> and <span class="math inline">\(\gamma\)</span> is the threshold to be used on all the <span class="math inline">\(\beta_j\)</span>. Our algorithm continues while the number of iterations does not 1000 and the approximate log-likelihood of current parameter estimates exceeds the <span class="math inline">\(1^{-5}\)</span>.We proceed by performing 5-fold cross-validation to search for the optimal <span class="math inline">\(\lambda\)</span>. The optimal <span class="math inline">\(\lambda\)</span> will be the one that minimizes the test MSE.</p>
</div>
<div id="the-algorithm-1" class="section level2">
<h2>The Algorithm</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># x: variables matrix (does not include vector of 1&#39;s for intercept)</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># y: binary response variable (malignant vs. benign)</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># beta: starting values of beta parameters</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># lambda: penalty on l1 regularization</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">func.logLasso.cd &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, beta, lambda, <span class="dt">tol =</span> <span class="fl">10e-6</span>, <span class="dt">maxiter =</span> <span class="dv">1000</span>){</a>
<a class="sourceLine" id="cb3-7" title="7">  </a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="co"># Initialize parameters</span></a>
<a class="sourceLine" id="cb3-9" title="9">  beta0 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">length</span>(y) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(y <span class="op">-</span><span class="st"> </span>x <span class="op">%*%</span><span class="st"> </span>beta)</a>
<a class="sourceLine" id="cb3-10" title="10">  </a>
<a class="sourceLine" id="cb3-11" title="11">  cur.p &lt;-<span class="st"> </span><span class="kw">func.cur.p</span>(<span class="dt">beta0 =</span> beta0, <span class="dt">beta =</span> beta, <span class="dt">x =</span> x) </a>
<a class="sourceLine" id="cb3-12" title="12">  cur.w &lt;-<span class="st"> </span><span class="kw">func.weights</span>(<span class="dt">p =</span> cur.p<span class="op">$</span>p)</a>
<a class="sourceLine" id="cb3-13" title="13">  cur.z &lt;-<span class="st"> </span><span class="kw">func.resp</span>(<span class="dt">u =</span> cur.p<span class="op">$</span>u,</a>
<a class="sourceLine" id="cb3-14" title="14">                       <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb3-15" title="15">                       <span class="dt">p =</span> cur.p<span class="op">$</span>p)</a>
<a class="sourceLine" id="cb3-16" title="16">  </a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="co"># Quadratic approx. of loglik at starting beta values</span></a>
<a class="sourceLine" id="cb3-18" title="18">  l_Q &lt;-<span class="st"> </span><span class="kw">func.obj</span>(<span class="dt">u =</span> cur.p<span class="op">$</span>u, </a>
<a class="sourceLine" id="cb3-19" title="19">                    <span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb3-20" title="20">                    <span class="dt">w =</span> cur.w,</a>
<a class="sourceLine" id="cb3-21" title="21">                    <span class="dt">z =</span> cur.z,</a>
<a class="sourceLine" id="cb3-22" title="22">                    <span class="dt">lambda =</span> lambda,</a>
<a class="sourceLine" id="cb3-23" title="23">                    <span class="dt">beta =</span> beta)</a>
<a class="sourceLine" id="cb3-24" title="24">  i &lt;-<span class="st"> </span><span class="dv">0</span> </a>
<a class="sourceLine" id="cb3-25" title="25">  track.param &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">iter =</span> <span class="dv">0</span>, l_Q, beta0,beta)</a>
<a class="sourceLine" id="cb3-26" title="26">  </a>
<a class="sourceLine" id="cb3-27" title="27">  <span class="co"># Updating parameters </span></a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="cf">while</span> (i <span class="op">&lt;</span><span class="st"> </span>maxiter <span class="op">&amp;&amp;</span><span class="st"> </span>l_Q <span class="op">&gt;</span><span class="st"> </span>tol) {</a>
<a class="sourceLine" id="cb3-29" title="29">    </a>
<a class="sourceLine" id="cb3-30" title="30">    i =<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-31" title="31">    </a>
<a class="sourceLine" id="cb3-32" title="32">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(beta)) {</a>
<a class="sourceLine" id="cb3-33" title="33">    </a>
<a class="sourceLine" id="cb3-34" title="34">      <span class="co"># Run coordinate descent algorithm on penalized weighted-LS to update betas</span></a>
<a class="sourceLine" id="cb3-35" title="35">      r &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span>(x <span class="op">%*%</span><span class="st"> </span>beta) <span class="co"># current residual</span></a>
<a class="sourceLine" id="cb3-36" title="36">      y.diff &lt;-<span class="st"> </span>r <span class="op">+</span><span class="st"> </span>(x[,j] <span class="op">*</span><span class="st"> </span>beta[j])</a>
<a class="sourceLine" id="cb3-37" title="37">      weighted.beta &lt;-<span class="st"> </span><span class="kw">sum</span>(cur.w <span class="op">*</span><span class="st"> </span>x[,j] <span class="op">*</span><span class="st"> </span>y.diff)</a>
<a class="sourceLine" id="cb3-38" title="38">      <span class="co"># update betas</span></a>
<a class="sourceLine" id="cb3-39" title="39">      beta[j] &lt;-<span class="st"> </span><span class="kw">func.soft</span>(<span class="dt">beta =</span> weighted.beta, <span class="dt">gamma =</span> lambda)<span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(cur.w <span class="op">*</span><span class="st"> </span>x[,j]<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-40" title="40">    }</a>
<a class="sourceLine" id="cb3-41" title="41">    </a>
<a class="sourceLine" id="cb3-42" title="42">    track.param &lt;-<span class="st"> </span><span class="kw">rbind</span>(track.param, <span class="kw">c</span>(<span class="dt">iter =</span> i, l_Q, beta0, beta))</a>
<a class="sourceLine" id="cb3-43" title="43">    </a>
<a class="sourceLine" id="cb3-44" title="44">    <span class="co"># Update quadratic approx. of loglik using updated parameters</span></a>
<a class="sourceLine" id="cb3-45" title="45">    beta0 &lt;-<span class="st"> </span><span class="kw">mean</span>(y) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">colMeans</span>(x) <span class="op">*</span><span class="st"> </span>beta)</a>
<a class="sourceLine" id="cb3-46" title="46">    cur.p &lt;-<span class="st"> </span><span class="kw">func.cur.p</span>(<span class="dt">beta0 =</span> beta0, <span class="dt">beta =</span> beta, <span class="dt">x =</span> x) </a>
<a class="sourceLine" id="cb3-47" title="47">    cur.w &lt;-<span class="st"> </span><span class="kw">func.weights</span>(<span class="dt">p =</span> cur.p<span class="op">$</span>p)</a>
<a class="sourceLine" id="cb3-48" title="48">    cur.z &lt;-<span class="st"> </span><span class="kw">func.resp</span>(<span class="dt">u =</span> cur.p<span class="op">$</span>u,</a>
<a class="sourceLine" id="cb3-49" title="49">                       <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb3-50" title="50">                       <span class="dt">p =</span> cur.p<span class="op">$</span>p)</a>
<a class="sourceLine" id="cb3-51" title="51">    l_Q &lt;-<span class="st"> </span><span class="kw">func.obj</span>(<span class="dt">u =</span> cur.p<span class="op">$</span>u, </a>
<a class="sourceLine" id="cb3-52" title="52">                    <span class="dt">x =</span> X,</a>
<a class="sourceLine" id="cb3-53" title="53">                    <span class="dt">w =</span> cur.w,</a>
<a class="sourceLine" id="cb3-54" title="54">                    <span class="dt">z =</span> cur.z,</a>
<a class="sourceLine" id="cb3-55" title="55">                    <span class="dt">lambda =</span> lambda,</a>
<a class="sourceLine" id="cb3-56" title="56">                    <span class="dt">beta =</span> beta)</a>
<a class="sourceLine" id="cb3-57" title="57">    </a>
<a class="sourceLine" id="cb3-58" title="58">     </a>
<a class="sourceLine" id="cb3-59" title="59">  }</a>
<a class="sourceLine" id="cb3-60" title="60">  </a>
<a class="sourceLine" id="cb3-61" title="61">  track.param &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(track.param)</a>
<a class="sourceLine" id="cb3-62" title="62">  <span class="kw">names</span>(track.param) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;iter&quot;</span>, <span class="st">&quot;approx_loglik&quot;</span>, <span class="st">&quot;intercept&quot;</span>, <span class="kw">colnames</span>(X))</a>
<a class="sourceLine" id="cb3-63" title="63">  </a>
<a class="sourceLine" id="cb3-64" title="64">  final.coef &lt;-<span class="st"> </span><span class="kw">tail</span>(track.param[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-65" title="65">  <span class="kw">return</span>(final.coef)</a>
<a class="sourceLine" id="cb3-66" title="66">}</a>
<a class="sourceLine" id="cb3-67" title="67"></a>
<a class="sourceLine" id="cb3-68" title="68"><span class="co"># Try lambda = e^(1/2)</span></a>
<a class="sourceLine" id="cb3-69" title="69"><span class="co">#func.logLasso.cd(x = X, y = Y, beta = rep(0, ncol(X)), exp(.5))</span></a></code></pre></div>
<div class="figure">
<img src="pic/logistic_lambda.png" alt="5-fold cv for different \lambda" />
<p class="caption">5-fold cv for different <span class="math inline">\(\lambda\)</span></p>
</div>
</div>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
<p>This project is to explore the predictivity of two different models on predicting the cancer malignancy. The results coefficients are listed in the following table. From the table, we can find the possible variables we can use to predict the cancer status based on the imaging data. We may observe that the Newton-Raphson algorithm converges much faster than the descending coordinate logistic lasso. However, Logistic-LASSO produced a model that was more accurate and effective at predicting cancer malignancy.</p>
<p><img src="pic/logistic_prediction.png" alt="Prediction Performance" /> <img src="pic/logistic_table.png" alt="Estimation Table" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
